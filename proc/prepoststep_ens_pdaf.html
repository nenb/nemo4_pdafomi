<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
   
   <meta name="description" content="PDAFOMI attachments to the NEMO4 ocean model.">
    
    <meta name="author" content="Nick Byrne" >
    <link rel="icon" href="../favicon.png">

    <title>prepoststep_ens_pdaf &ndash; NEMO4 PDAFOMI</title>

    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/local.css" rel="stylesheet">
    
    <link  href="../tipuesearch/tipuesearch.css" rel="stylesheet">
    
    

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <script src="../js/jquery-2.1.3.min.js"></script>
    <script src="../js/svg-pan-zoom.min.js"></script>

  </head>

  <body>

    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../index.html">NEMO4 PDAFOMI </a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
        
            <li class="dropdown hidden-xs visible-sm visible-md hidden-lg">
              <a href="#" class="dropdown-toggle"
              data-toggle="dropdown" role="button"
              aria-haspopup="true"
     aria-expanded="false">Contents <span class="caret"></span></a>
        <ul class="dropdown-menu">
          
              
            <li><a href="../lists/files.html">Source Files</a></li>
        
        
        
            <li><a href="../lists/modules.html">Modules</a></li>
        
            
                                
            <li><a href="../lists/procedures.html">Procedures</a></li>
        
               
        
            </ul>
            </li>


<li class="visible-xs hidden-sm visible-lg"><a href="../lists/files.html">Source Files</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/modules.html">Modules</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/procedures.html">Procedures</a></li>

                             

          </ul>
        
        <form action="../search.html" class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="text" class="form-control" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
        </div>
<!--
        <button type="submit" class="btn btn-default">Submit</button>
-->
        </form>
        
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">
    
  
  <div class="row">
    <h1>prepoststep_ens_pdaf
      <small>Subroutine</small>
    
    </h1>
    
<div class="row">
  <div class="col-lg-12">
<div class="well well-sm">
  <ul class="list-inline" style="margin-bottom:0px;display:inline">
     
     
     
     
    
    
     <li><i class="fa fa-list-ol"></i>
       <a data-toggle="tooltip"
    data-placement="bottom" data-html="true"
    title=" 3.0% of total for procedures.">14 statements</a>
     </li> 
     
     
     
    <li><i class="fa fa-code"></i><a href="../src/prepoststep_ens_pdaf.F90"> Source File</a></li>
     
     
  </ul>
  <ol class="breadcrumb in-well text-right">
  
    
     <li><a href='../sourcefile/prepoststep_ens_pdaf.f90.html'>prepoststep_ens_pdaf.F90</a></li>
    
  
     <li class="active">prepoststep_ens_pdaf</li>
  </ol>
</div>
</div>
</div>
<script>
  $(function () {
  $('[data-toggle="tooltip"]').tooltip()
  })
</script>

  </div>
  
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">
    
<div id="sidebar">
  
<h3>Contents</h3>
 





















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../proc/prepoststep_ens_pdaf.html#src">prepoststep_ens_pdaf</a>
  </div>
</div>



</div>

    </div>
    
    <div class="col-md-9" id='text'>
    <h2>
subroutine prepoststep_ens_pdaf(step, dim_p, dim_ens, dim_ens_p, dim_obs_p, state_p, Uinv, ens_p, flag)
    
    
   
</h2>
    
  
    <div class="panel panel-default">
      <div class="panel-heading">
  <h3 class="panel-title">Uses</h3>
      </div>
      <ul class="list-group">
      
      <li class="list-group-item">
  <ul class="list-inline">
    
    <li><a href='../module/mod_kind_pdaf.html'>mod_kind_pdaf</a></li>
    
  </ul>
      </li>
      
      
      
      </ul>
    </div>
    


    
    <h2 id="controlling-pre-and-post-processing-pdaf-output">Controlling Pre- and Post-Processing, PDAF Output</h2>
<p>The routine is called for global filters (e.g. SEIK)
before the analysis and after the ensemble transformation.
For local filters (e.g. LSEIK) the routine is called
before and after the loop over all local analysis
domains.</p>
<p>The routine provides full access to the state
estimate and the state ensemble to the user.
Thus, user-controlled pre- and poststep
operations can be performed here. For example
the forecast and the analysis states and ensemble
covariance matrix can be analyzed, e.g. by
computing the estimated variances.
For the offline mode, this routine is the place
in which the writing of the analysis ensemble
can be performed.</p>
<p>If a user considers to perform adjustments to the
estimates (e.g. for balances), this routine is
the right place for it.</p>
<p><strong>Calling Sequence</strong>
<em>Called by:</em> <code>PDAF_get_state</code> (as U_prepoststep)
<em>Called by:</em> <code>PDAF_X_update</code> (as U_prepoststep)</p>
    

    <h3>Arguments</h3>
    
      
<table class="table table-striped varlist">
<thead><tr><th>Type</th>
<th>Intent</th><th>Optional</th>
<th>Attributes</th><th></th><th>Name</th><th></th></thead>



<tbody>

  
  
  
  
<tr>
  
  <td><span class="anchor" id="variable-step"></span>integer,</td>
  <td>intent(in)</td>
  <td></td>
  
  <td></td><td>::</td>
  <td><strong>step</strong></td><td><p>Current time step (negative for call after forecast)</p></td>
  
</tr>

  
  
  
  
<tr>
  
  <td><span class="anchor" id="variable-dim_p~3"></span>integer,</td>
  <td>intent(in)</td>
  <td></td>
  
  <td></td><td>::</td>
  <td><strong>dim_p</strong></td><td><p>PE-local state dimension</p></td>
  
</tr>

  
  
  
  
<tr>
  
  <td><span class="anchor" id="variable-dim_ens~2"></span>integer,</td>
  <td>intent(in)</td>
  <td></td>
  
  <td></td><td>::</td>
  <td><strong>dim_ens</strong></td><td><p>Size of state ensemble</p></td>
  
</tr>

  
  
  
  
<tr>
  
  <td><span class="anchor" id="variable-dim_ens_p"></span>integer,</td>
  <td>intent(in)</td>
  <td></td>
  
  <td></td><td>::</td>
  <td><strong>dim_ens_p</strong></td><td><p>PE-local size of ensemble</p></td>
  
</tr>

  
  
  
  
<tr>
  
  <td><span class="anchor" id="variable-dim_obs_p"></span>integer,</td>
  <td>intent(in)</td>
  <td></td>
  
  <td></td><td>::</td>
  <td><strong>dim_obs_p</strong></td><td><p>PE-local dimension of observation vector</p></td>
  
</tr>

  
  
  
  
<tr>
  
  <td><span class="anchor" id="variable-state_p~3"></span>real(kind=pwp),</td>
  <td>intent(inout)</td>
  <td></td>
  
  <td></td><td>::</td>
  <td><strong>state_p</strong>(dim_p)</td><td><p>PE-local forecast/analysis state
 The array &lsquo;state_p&rsquo; is initialised and can be used
 freely here (not for SEEK!)</p></td>
  
</tr>

  
  
  
  
<tr>
  
  <td><span class="anchor" id="variable-uinv~2"></span>real(kind=pwp),</td>
  <td>intent(inout)</td>
  <td></td>
  
  <td></td><td>::</td>
  <td><strong>Uinv</strong>(dim_ens-1,dim_ens-1)</td><td><p>Inverse of matrix U</p></td>
  
</tr>

  
  
  
  
<tr>
  
  <td><span class="anchor" id="variable-ens_p~2"></span>real(kind=pwp),</td>
  <td>intent(inout)</td>
  <td></td>
  
  <td></td><td>::</td>
  <td><strong>ens_p</strong>(dim_p,dim_ens)</td><td><p>PE-local state ensemble</p></td>
  
</tr>

  
  
  
  
<tr>
  
  <td><span class="anchor" id="variable-flag~2"></span>integer,</td>
  <td>intent(in)</td>
  <td></td>
  
  <td></td><td>::</td>
  <td><strong>flag</strong></td><td><p>PDAF status flag</p></td>
  
</tr>

</tbody>
</table>

    
    
    
    
     
    <br>

    <section class="visible-xs visible-sm hidden-md">
      
<h3>Contents</h3>
 





















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../proc/prepoststep_ens_pdaf.html#src">prepoststep_ens_pdaf</a>
  </div>
</div>



    </section>
    <br class="visible-xs visible-sm hidden-md">

    

    
    
    
    
    

    
    
    
    
    


    
    
    
    <section>
    <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="highlight"><pre><span></span><span class="k">SUBROUTINE </span><span class="n">prepoststep_ens_pdaf</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="n">dim_p</span><span class="p">,</span> <span class="n">dim_ens</span><span class="p">,</span> <span class="n">dim_ens_p</span><span class="p">,</span> <span class="n">dim_obs_p</span><span class="p">,</span> <span class="p">&amp;</span>
                                <span class="n">state_p</span><span class="p">,</span> <span class="n">Uinv</span><span class="p">,</span> <span class="n">ens_p</span><span class="p">,</span> <span class="n">flag</span><span class="p">)</span>

   <span class="k">USE </span><span class="n">mod_kind_pdaf</span>

   <span class="k">IMPLICIT NONE</span>

   <span class="c">!&gt; Current time step (negative for call after forecast)</span>
   <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">step</span>
   <span class="c">!&gt; PE-local state dimension</span>
   <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dim_p</span>
   <span class="c">!&gt; Size of state ensemble</span>
   <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dim_ens</span>
   <span class="c">!&gt; PE-local size of ensemble</span>
   <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dim_ens_p</span>
   <span class="c">!&gt; PE-local dimension of observation vector</span>
   <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dim_obs_p</span>
   <span class="c">!&gt; PE-local forecast/analysis state</span>
   <span class="c">!&gt; The array &#39;state_p&#39; is initialised and can be used</span>
   <span class="c">!&gt; freely here (not for SEEK!)</span>
   <span class="kt">REAL</span><span class="p">(</span><span class="n">pwp</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">state_p</span><span class="p">(</span><span class="n">dim_p</span><span class="p">)</span>
   <span class="c">!&gt; Inverse of matrix U</span>
   <span class="kt">REAL</span><span class="p">(</span><span class="n">pwp</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">Uinv</span><span class="p">(</span><span class="n">dim_ens</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dim_ens</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
   <span class="c">!&gt; PE-local state ensemble</span>
   <span class="kt">REAL</span><span class="p">(</span><span class="n">pwp</span><span class="p">),</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ens_p</span><span class="p">(</span><span class="n">dim_p</span><span class="p">,</span> <span class="n">dim_ens</span><span class="p">)</span>
   <span class="c">!&gt; PDAF status flag</span>
   <span class="kt">INTEGER</span><span class="p">,</span> <span class="k">INTENT</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">flag</span>

   <span class="k">WRITE</span> <span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="s1">&#39;(/1x,a)&#39;</span><span class="p">)</span> <span class="s1">&#39;Insert prepoststep routines here. &#39;</span>

<span class="k">END SUBROUTINE </span><span class="n">prepoststep_ens_pdaf</span>
</pre></div>

    </section>
    <br>
    
    
    </div>
  </div>


    <hr>    
    </div> <!-- /container -->
    <footer>
      <div class="container">
      <div class="row">
        <div class="col-xs-6 col-md-4"><p>&copy; 2021 
                                          </p></div>
        <div class="col-xs-6 col-md-4 col-md-push-4">
          <p class="text-right">
            Documentation generated by 
            <a href="https://github.com/cmacmackin/ford">FORD</a>
            
          </p>
        </div>
        <div class="col-xs-12 col-md-4 col-md-pull-4"><p class="text-center"> NEMO4 PDAFOMI was developed by Nick Byrne</p></div>
      </div>
      <br>
      </div> <!-- /container -->    
    </footer>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
<!--
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
-->
    <script src="../js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../js/ie10-viewport-bug-workaround.js"></script>

    <!-- MathJax JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },
        jax: ['input/TeX','input/MathML','output/HTML-CSS'],
        extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']
      });
    </script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    
    <script src="../tipuesearch/tipuesearch_content.js"></script>
    <script src="../tipuesearch/tipuesearch_set.js"></script>
    <script src="../tipuesearch/tipuesearch.js"></script>
    
    
  </body>
</html>